
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRM ERD — Final with Icon Toggle</title>
  <script src="https://unpkg.com/gojs/release/go.js"></script>
  <script src="https://gojs.net/latest/extensions/Themes.js"></script>
  <script src="https://gojs.net/latest/extensions/Figures.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: ui-sans-serif, sans-serif;
      transition: background 0.3s ease;
    }
    #myDiagramDiv {
      width: 100%;
      height: calc(100vh - 64px);
    }
    header {
      height: 64px;
      background-color: #1e3a8a;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
    }
    button.theme-toggle {
      background: transparent;
      border: none;
      cursor: pointer;
      color: white;
      padding: 0.5rem;
      transition: color 0.2s ease;
    }
    button.theme-toggle svg {
      height: 24px;
      width: 24px;
    }
  </style>
</head>
<body>
<header>
  <h1 style="font-weight:bold;font-size:1.2rem;">CRM ERD — Final</h1>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Theme">
    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5"
         viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 3v1m0 16v1m8.49-8.49l.71.71M4.8 4.8l.71.71M21 12h1M2 12H1m15.19 6.19l.71.71M6.1 6.1l.71.71" />
    </svg>
  </button>
</header>
<div id="myDiagramDiv"></div>
<script>
function init() {
  const $ = go.GraphObject.make;
  const diagram = $(go.Diagram, "myDiagramDiv", {
    layout: $(go.ForceDirectedLayout, { isInitial: false }),
    "undoManager.isEnabled": true,
    "themeManager.themeMap": new go.Map([
      { key: "light", value: Modern },
      { key: "dark", value: ModernDark }
    ]),
    "themeManager.changesDivBackground": true,
    "themeManager.currentTheme": "system"
  });

  diagram.themeManager.set("light", {
    colors: {
      primary: "#f7f9fc", green: "#62bd8e", blue: "#3999bf", purple: "#7f36b0", red: "#c41000"
    }
  });
  diagram.themeManager.set("dark", {
    colors: {
      primary: "#4a4a4a", green: "#429e6f", blue: "#3f9fc6", purple: "#9951c9", red: "#ff4d3d"
    }
  });

  const itemTempl = $(go.Panel, "Horizontal", { margin: new go.Margin(2, 0) })
    .add(
      $(go.Shape,
        { desiredSize: new go.Size(15, 15), strokeWidth: 0, margin: new go.Margin(0, 5, 0, 0) },
        new go.Binding("figure", "figure"),
        new go.Binding("fill", "color")
      ),
      $(go.TextBlock,
        { font: "14px sans-serif" },
        new go.Binding("text", "name"),
        new go.Binding("font", "iskey", k => k ? "italic 14px sans-serif" : "14px sans-serif"))
    );

  diagram.nodeTemplate = $(go.Node, "Auto",
    $(go.Shape, "RoundedRectangle", {
      stroke: "#e8f1ff", strokeWidth: 3
    }).theme("fill", "primary"),
    $(go.Panel, "Table", {
      margin: 8,
      stretch: go.Stretch.Fill
    })
      .addRowDefinition(0, { sizing: go.Sizing.None })
      .add(
        $(go.TextBlock, {
          row: 0, alignment: go.Spot.Center,
          margin: new go.Margin(0, 24, 0, 2), font: "bold 18px sans-serif"
        }).bind("text", "key").theme("stroke", "text"),
        go.GraphObject.build("PanelExpanderButton", {
          row: 0, alignment: go.Spot.TopRight
        }, "LIST").theme("ButtonIcon.stroke", "text"),
        $(go.Panel, "Table", {
          name: "LIST", row: 1, alignment: go.Spot.TopLeft
        })
          .add(
            $(go.TextBlock, "Attributes", {
              row: 0, alignment: go.Spot.Left,
              margin: new go.Margin(3, 24, 3, 2),
              font: "bold 15px sans-serif"
            }).theme("stroke", "text"),
            go.GraphObject.build("PanelExpanderButton", {
              row: 0, alignment: go.Spot.Right
            }, "NonInherited").theme("ButtonIcon.stroke", "text"),
            $(go.Panel, "Vertical", {
              row: 1, name: "NonInherited", alignment: go.Spot.TopLeft,
              defaultAlignment: go.Spot.Left, itemTemplate: itemTempl
            }).bind("itemArray", "items"),
            $(go.TextBlock, "Inherited Attributes", {
              row: 2, alignment: go.Spot.Left,
              margin: new go.Margin(3, 24, 3, 2),
              font: "bold 15px sans-serif"
            }).bind("visible", "inheritedItems", arr => Array.isArray(arr) && arr.length > 0)
              .theme("stroke", "text"),
            go.GraphObject.build("PanelExpanderButton", {
              row: 2, alignment: go.Spot.Right
            }, "Inherited").bind("visible", "inheritedItems", arr => Array.isArray(arr) && arr.length > 0)
              .theme("ButtonIcon.stroke", "text"),
            $(go.Panel, "Vertical", {
              row: 3, name: "Inherited", alignment: go.Spot.TopLeft,
              defaultAlignment: go.Spot.Left, itemTemplate: itemTempl
            }).bind("itemArray", "inheritedItems")
          )
      )
  );

  diagram.linkTemplate = $(go.Link, {
    routing: go.Link.AvoidsNodes,
    corner: 5,
    curve: go.Curve.JumpOver
  },
    $(go.Shape, { stroke: "#f7f9fc", strokeWidth: 3 }).theme("stroke", "link"),
    $(go.TextBlock, {
      segmentIndex: 0, segmentOffset: new go.Point(0, -10), font: "10px sans-serif"
    }).bind("text").theme("stroke", "text"),
    $(go.TextBlock, {
      segmentIndex: -1, segmentOffset: new go.Point(0, -10), font: "10px sans-serif"
    }).bind("text", "toText").theme("stroke", "text")
  );

  diagram.model = new go.GraphLinksModel;
  console.log("Diagram Model Loaded:", diagram.model);([{"key": "contacts", "items": [{"name": "first_name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "last_name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "email", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "phone", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [{"name": "id", "figure": "Decision", "color": "purple", "iskey": true}], "color": "#93c5fd", "loc": "0 0"}, {"key": "organizations", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "website", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "type", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#93c5fd", "loc": "0 0"}, {"key": "artists", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "genre", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "contact", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#93c5fd", "loc": "0 0"}, {"key": "deals", "items": [{"name": "title", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "value", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "stage", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#fde68a", "loc": "0 0"}, {"key": "proposals", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "status", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "contact", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#fde68a", "loc": "0 0"}, {"key": "events", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "date", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "venue", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#6ee7b7", "loc": "0 0"}, {"key": "bookings", "items": [{"name": "event", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "artist", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "status", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#6ee7b7", "loc": "0 0"}, {"key": "logistics", "items": [{"name": "transport", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "crew", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "notes", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#6ee7b7", "loc": "0 0"}, {"key": "invoices", "items": [{"name": "number", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "amount", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "due_date", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#fecdd3", "loc": "0 0"}, {"key": "contracts", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "signed_by", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "status", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#fecdd3", "loc": "0 0"}, {"key": "tasks", "items": [{"name": "title", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "deadline", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "assigned_to", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#ddd6fe", "loc": "0 0"}, {"key": "updates", "items": [{"name": "update", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "timestamp", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#ddd6fe", "loc": "0 0"}, {"key": "inbox", "items": [{"name": "subject", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "from", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "received_at", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#bae6fd", "loc": "0 0"}, {"key": "conversations", "items": [{"name": "topic", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "participants", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#bae6fd", "loc": "0 0"}, {"key": "messages", "items": [{"name": "body", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "sent_at", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "sender", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#bae6fd", "loc": "0 0"}, {"key": "directus_users", "items": [{"name": "email", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "role", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#e5e7eb", "loc": "0 0"}, {"key": "directus_roles", "items": [{"name": "name", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "app_access", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#e5e7eb", "loc": "0 0"}, {"key": "directus_files", "items": [{"name": "filename", "figure": "Hexagon", "color": "blue", "iskey": false}, {"name": "type", "figure": "Hexagon", "color": "blue", "iskey": false}], "inheritedItems": [], "color": "#e5e7eb", "loc": "0 0"}], [{"from": "contacts", "to": "organizations", "text": "works for"}, {"from": "contacts", "to": "artists", "text": "manages"}, {"from": "artists", "to": "events", "text": "performs at"}, {"from": "bookings", "to": "events", "text": "booking for"}, {"from": "bookings", "to": "artists", "text": "artist"}, {"from": "proposals", "to": "contacts", "text": "sent to"}, {"from": "deals", "to": "proposals", "text": "based on"}, {"from": "contracts", "to": "bookings", "text": "contracted"}, {"from": "invoices", "to": "contracts", "text": "billed for"}, {"from": "tasks", "to": "updates", "text": "progress"}, {"from": "conversations", "to": "messages", "text": "contains"}, {"from": "inbox", "to": "messages", "text": "delivers"}, {"from": "contacts", "to": "directus_users", "text": "linked user"}, {"from": "directus_users", "to": "directus_roles", "text": "has role"}]);
  diagram.zoomToFit();
}

function toggleTheme() {
  const d = go.Diagram.fromDiv("myDiagramDiv");
  const current = d.themeManager.currentTheme;
  const newTheme = current === "dark" ? "light" : "dark";
  d.themeManager.currentTheme = newTheme;

  const icon = document.getElementById("themeIcon");
  icon.innerHTML = newTheme === "dark"
    ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>'
    : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.49-8.49l.71.71M4.8 4.8l.71.71M21 12h1M2 12H1m15.19 6.19l.71.71M6.1 6.1l.71.71" />';
}

window.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
